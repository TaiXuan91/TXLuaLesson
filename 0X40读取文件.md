# 0X40读取文件

## 前置知识

* 0X3F文件模型

## 正文

### 逐行读取

首先要读取文件,文件模型必须按照可读的模式打开.

>```lua
>file:read()
>```

这个函数每调用一次就会返回file中的一行.

### 批量读取

每个文件模型都有lines函数.例如:

>```lua
>f=file:lines()
>```

f是一个可迭代函数,包含file的全部内容.调用f一次会返回一行.它可以直接当作迭代器用于for循环,例如输出file中所有行:

>```lua
>for x in file:lines() do
>    print(x)
>end
>```

### read函数的参数

read函数可以接受参数来确定读取的内容.

'n'会让read读取一个数字,返回一个number类型的值.

'a'会让read读取整个文件并返回.

'l'会让read读取的时候,返回的字符串中不包括换行符.

'L'会让read读取的时候,返回的字符串中包含换行符.

### 移动读写点

文件模型会保存当前读写的字符位置.随着read或者write的调用,这个读写点会自动移动.如果要重新读取某一段内容或者覆盖某一段已经存在的内容,就需要移动读写点.


file:seek ([whence [, offset]])

Sets and gets the file position, measured from the beginning of the file, to the position given by offset plus a base specified by the string whence, as follows:

"set": base is position 0 (beginning of the file);
"cur": base is current position;
"end": base is end of file;
In case of success, seek returns the final file position, measured in bytes from the beginning of the file. If seek fails, it returns nil, plus a string describing the error.

The default value for whence is "cur", and for offset is 0. Therefore, the call file:seek() returns the current file position, without changing it; the call file:seek("set") sets the position to the beginning of the file (and returns 0); and the call file:seek("end") sets the position to the end of the file, and returns its size.



io.tmpfile ()

In case of success, returns a handle for a temporary file. This file is opened in update mode and it is automatically removed when the program ends.

io.type (obj)

Checks whether obj is a valid file handle. Returns the string "file" if obj is an open file handle, "closed file" if obj is a closed file handle, or nil if obj is not a file handle.




剩下的在文件系统或者动态脚本中介绍.

6.9 – Operating System Facilities

This library is implemented through table os.

os.tmpname ()

Returns a string with a file name that can be used for a temporary file. The file must be explicitly opened before its use and explicitly removed when no longer needed.

On POSIX systems, this function also creates a file with that name, to avoid security risks. (Someone else might create the file with wrong permissions in the time between getting the name and creating the file.) You still have to open the file to use it and to remove it (even if you do not use it).

When possible, you may prefer to use io.tmpfile, which automatically removes the file when the program ends.




## 后续推荐