# 0X47同时执行

## 前置知识

* 0X41动态脚本

## 正文

### 同时的定义

有时候我们需要两个或者更多的程序(或者代码块同时进行),以完成实时控制或者节省时间.这就需要用到线程(或者进程)控制.

在进一步讨论之前要先说一下"同时"的定义.一般来说有两种符合直观意义上的"同时"的机制.

一种是每时每刻两件事都在同步推进,称为parallel.

另一种是两件事情快速交替,这一时刻推进这个,那一时刻推进那个,称为concurrent.

如果同时推进的进程数小于等于CPU核心数,一般认为是parallel.否则一般以concurrent方式推进.

### Lua的线程定义

Lua的脚本是从头到尾解释的.我们不可能在同一时刻定义若干个时间并让它们启动执行.但是可以先把若干份脚本写好,然后再在很短的时间间隔内启动所有脚本.

我们之前已经介绍过把一个代码块或者脚本打包成一个函数.但是如果仅仅是顺序执行函数,必定是一个函数执行完然后下一个函数才开始执行.这无法达到"同时"的目的.为此魔门需要使用Lua中最后一种没有介绍到的值类型--线程(thread).

先把函数转换为线程.然后逐个启动线程.启动一个线程只需要很短的时间.然后我们顺序启动其他线程(此时刚刚启动的线程中的函数还没有执行完).这样就能实现很多代码块(或者脚本)'同时'执行.

### 线程创建

创建线程使用coroutine.create函数.它接受一个函数作为参数返回一个线程.当这个线程启动时就会执行这个函数.函数执行完毕,线程也就终止.

### 线程的启动


coroutine.create (f)

Creates a new coroutine, with body f. f must be a function. Returns this new coroutine, an object with type "thread".



线程带来的问题
不安全,死锁

f=function ()
local i=0
repeat
print('a')
i++
until i>100
end

g=function()
local j=0
repeat
print(j)
until j>100
end

可能对线程的理解有问题.仔细重看一下.



## 后续推荐