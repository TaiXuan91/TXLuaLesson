# 预定义数据类型

必要前驱：

- [基本动作](Chapter06.md)

一个程序就是许多计算和赋值操作的组合。现在我们介绍过了基本的赋值命令，返回命令以及流程控制。现在还缺一块拼图——计算。C#中的计算是通过常量和变量之间的运算（或者函数调用）完成的。而要讲清楚这个问题，就需要分两个步骤——先讲类型，然后讲类型的运算。

我们先来讲讲类型。但是类型也需要讲很多内容。我们先来讲C#的预定义类型。这些类型是不需要我们定义的，而是C#（或者dotnet）中自带的，可以直接使用的。预定义数据类型这一部分和流程控制一样，对于很多语言来说都是老生常谈，大同小异。所以我们这里也快速带过。

## 类型和类型的构造

面向对象编程中，几乎所有东西都是对象。对象是类的实例化，由同一个类实例化出来的对象属于同一个类。

如果用数学上的概念来类比的话，类就相当于集合，而类的成员则相当于集合的元素（仅仅是类似，实质上是很不同的）。现在我们暂时不考虑集合和其元素的关系，而着重考虑一下集合（类型）之间的关系。

首先C#中存在一些预定义类型，这些类型是怎么来的不需要我们操心，直接使用就可以。预定义的类型都是最基本的类型。如果这些类型不能表示我们需要表示的数据，C#还提供了一些方法让我们自己定义新的类型。例如定义类，定义结构体，定义枚举。

> 类型系统是一个很大的话题。虽然C#是静态类型语言，但是我认为相比Haskell，C#的类型系统还是差点意思，因此这里我们不详细介绍类型系统。

## 值和引用

值类型和引用类型从C一直说到这里。但是这只是内存管理上引申出来的一个问题。其实在C#编程中，值类型的种类相对较少。整数，浮点数，字符，布尔这几种是值类型。复合类型中结构体是值类型。另外，本质是整型的枚举也是值类型。其他基本上都是引用类型（字符串，数组，函数代理，任何其他类实例）。

引用类型和值类型除了作为参数传递的时候，有区别（指针复制和值复制）。C#中二者还有一处区别——引用类型可能被赋予`null`，值类型不能被赋予`null`。

> 因为据说新标准中要提出不可被赋予`null`的引用类型。所以这里我说的是“可能”。

## 整型

### 整数的分类

整型数就是整数。但是也有出于内存管理的问题。我们实际中没有任意长度整数可用（所有计算机的存储空间都是有限的）。所以整型被细分为很多小类别，不过大多数都是根据表示整数用的二进制位数分开的。

另外为了提高二进制位的利用率。在不需要负数的时候，我们可以把符号位也用来计数，这样就有了无符号整型。

### 整数的字面值

整数的字面值其实有很多种写法。一般常用的是十进制的。但是，计算机上也常用十六进制写法。C#种还提供了一些别的写法，方便数整数位数之类的。这里我们就不一一介绍的。

只需要记住一个机巧，不加小数点的都默认是整数，加了小数点的都默认是浮点数。

### 整数的运算

整数可以加减乘除。不过注意整数的除法默认是除整取余。两个整数相除，只返回整数商。

长度不同的整数运算。为了保证不损失精度，自动按照比较长的整数类型进行运算。

另外，一般认为浮点数的精度比整数高。所以整数和浮点数运算，会自动把整数转化为浮点数然后计算。

> 顺便说一句，整数不仅仅作为基数表示数量。也可以作为序数。作为序数的时候它们之间的加减乘除不是很重要。但是它们之间彼此不同，能相互区分很重要。比如switch语句中可以根据传入的整数选择要执行的分支。

## 字符

字符本质就是整型数。因为按照编码规则我们用整数表示字符。不过C#中不像C那样允许我们直接把整型和字符混为一谈。

关于字符的字面值，转移系列等内容基本上和C一致。我们就不多说了。强调一下字符基本没什么运算。

> 处理字符串的时候，一般用dotnet中已经实现正则替换之类的方法。很少使用逐个字符处理。所以这个类型的使用频率并不高。

## 逻辑值

逻辑值的本质也是整数。只不过只有0与1两种状态。字面值分别是`false`和`true`。类型名是`bool`。

C#中逻辑值也和整型做了比较严格的区分。不能混在一起使用。

另外逻辑值的运算和整数，浮点数差别比较大。主要是逻辑的与或非。另外，所有的比较算符的结果都是逻辑值。

## 浮点数

### 编码原理

浮点数不等同于数学上的实数。充其量是有理数。不过工程上没有必要深究数学上两个数是否全等。所以我们一般把浮点数当作实数的近似使用。

浮点数本质是有理数。而有理数可以用两个整数组成的整数对表示。不过计算机里浮点数编码并不是按照分子分母编码的。而是按照有效数字位数和权值编码的（外加一个符号位）。

### 浮点数分类

浮点数和整型数类似，也按长度分成了很多小类。常用的就是`float`以及总长度是`float`两倍的`double`。

### 浮点数字面值

浮点数和整数类似也有很多字面值写法。除了注意写浮点数的时候一定要加上小数点（就算写浮点数的一也要写成`1.0`），还应该注意一下浮点数有科学计数表示法。

> 浮点数和整数字面值都可以加一些前后缀表示字面值对应的数据类型（长度），进制等。这里不详述。

### 浮点数运算

浮点数承担了绝大多数数值计算方面的工作。除了常用的各种算符，我们还有数学库中的各种初等函数，近似函数可以用。

## 枚举

枚举并不能算组合类型。因为它并没有把几种类型组合成新类型。而是通过给整数起别名的方法创建新类型。

实际上枚举就是在应用整数的序数属性。我们有时候需要区分几种不同的状态，就可以用整数给状态编号。但是整数编号实在太难记，就给整数起一些字面值别名。这就是枚举。

> 枚举是C中继承过来的遗产。在一些比较现代的语言中，由于字符串比较运算被做得很方便使用。一般就用字符串来代替枚举的作用。例如C#中的switch就可以直接匹配字符串。不过为了兼容C的写法，还是把枚举类型加上了。

## 数组

数组是若干同类对象组成的结构。如果你熟悉C，那么不会对C#中的数组陌生。

值得一提的是C#中的数组更加灵活。例如C中以下几种写法是很不同的：

```C
int a[5][10]; //5*10的int矩阵
int *a[5]; //指向int的指针的数组（长度为5）
int (*a)[5]; //指向一个长度为5的int数组的指针
int **a; //指向int指针的指针
```

但是这些东西又有一些相似的用处——比如都能用于表示矩阵。在C#中它们能被统一成一种类型`int[][]`。这种类型可以像C中的`int a[5][10]`一样表示长宽固定的矩阵，也可以表示C中`int **a`一样表示一些“锯齿形”的二阶数组。

> 注意，数组是引用类型的。

## 字符串

在C中字符串就是结尾为`\0`的字符数组。而C#中的字符串`string`是一种预定义的类型。C#做了很多封装，让字符串操作更为简易。个人建议，从C转C#的人，一定要放下`string`就是是`char[]`的执念，多多使用内置的`string`处理方法。而不是用`for`循环去遍历`string`。

## 结构体

结构体（`struct`）将若干类型可以不同的成员打包成一个对象。

需要注意的是结构体看起来和对象非常像，但是二者是有很大不同的。

首先结构体是默认值传递的，而对象是默认引用传递的。但是结构体又是对象的特殊子类。我们可以通过装箱操作把结构体转化为引用类型（例如把一个结构体的值付给一个`Object`对象），或者通过拆箱操作把引用类型转化成值类型的结构体（例如把`Object`的对象强制转化成结构体）。

## 对象

本质上所有东西都是对象。甚至整数，浮点数这些非引用类型的类，也是对象（Object）的子类。为了解决`Object`是引用类型，而其子类`int`等是值类型的问题，dotnet把`int`等值类型作为`Object`的特殊子类。

