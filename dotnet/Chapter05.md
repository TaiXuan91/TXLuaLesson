# 基本动作

必要前驱：

- [变量和函数](Chapter04.md)

这一期我们来讨论函数体的定义中应该有些什么东西。

函数体内部的定义是面向过程的。因而，主要思路就是用若干已经定义好的动作组合成更为复杂的动作。我把能用到的已经定义好的动作分为三类——赋值，函数调用和返回。

## 赋值

赋值就是给变量以值。在面向过程的编程中，变量被认为是一个可以存放东西的盒子，而值是可以往变量这个东西中存放的东西。赋值语句的写法非常简单。就是用`=`连接两个部分。左边是被赋值的变量的名字，右边是要赋给变量的值。这个值可以是一个直接给定的常量，也可以是函数调用表达式。如果是函数调用表达式，我们就是将函数的返回值赋予变量。

变量在被赋值之前要先被声明。声明变量的写法和定义类字段一样。对于一个函数来说，它所属于的类的字段（如果这个函数有字段的访问权的话）以及函数参数列表中的变量相当于已经声明过的变量。使用之前不需要再声明。

> 赋值语句的右边当然也可以只写一个变量。这就相当于把等号右边的变量的值赋予等号左边。
>
> 但是这种操作的结果，要根据变量的类型确定。C#中把类型按存储和引用方式分为值传递和引用传递两大类。值传递的赋值是直接复制值，而引用传递是复制指针。如果暂时搞不清楚二者的区别，就像我在Python教程中说的那样——把所有值都当作引用传递。（例如把整数的二进制表示当作一个特殊的引用。）这样不容易导致错误。因为一般混淆引用传递和值传递时发生的错误，都是把引用传递误当作值传递造成的。而把值传递当作引用传递，把常数看作不可变对象，并不容易造成结果预期上的错误。

## 类型推断

既然说到了变量赋值我们就顺便说一下类型推断。C#中变量和值都是有类型的。只有类型相同值才能被赋予变量。在变量声明初始化的时候，我们使用的类型说明就要和初始化的值一致。但是这样写起来比较死板。因为语法限制这两者必须一致，我们还要人工把一致的东西写两次。

因而C#提供了`var`关键字。这个关键字用于替代类型说明。如果使用了这个关键字，变量的类型就由初始化时候的初始值的类型确定。比如这一段代码：

```C#
int i = 5;
string name = "Ciri";
char c = "X";
```

可以改写成：

```C#
var i = 5;
var name = "Ciri";
var c = "X";
```

## 常变量

常变量其实就是不能变的变量。对于整数，字符串等类型来说，其实常变量的功能基本上可以被字面值直接写替代。但是这样写起来很麻烦，而且万一以后要改更麻烦。在C语言时代人们用宏替换解决这个问题。但是宏本身弄得过于复杂，使得C语言看起来就像两门语言的混合（C和C的编译预处理宏）。而这种混合带来了大量难以理解的代码以及混乱。

> 有多混乱呢？简单来说你想用3.14这个常量至少有直接写字面值，写成宏替换，写成常变量三中写法。

所以C#中，几乎所有本来在C中通过宏解决的问题都强制改成了用C#语言本身的语句解决。体现在这个问题上就是所有常量一律用常变量处理。常变量的声明方法和普通变量差不多。只不过开头加上修饰`const`。另外常变量声明的时候必须初始化，初始化后常变量的值就不能再改变了（除了初始化，常变量不能被赋值）。例如：

```C#
const float pi = 3.14;
```

## 变量作用域

变量作用域的概念，仍然是为了解决重名的问题。我们考虑这样一个情况：有一个类A，其中定义了方法Fun1，方法Fun2和字段x。而方法Fun1又定义了一个变量x。那么在方法Fun1中访问变量x，访问的是哪个？

为了方便叙述，我们把整个类A的定义称为一个作用域，把Fun1，Fun2的定义也都称为作用域。只不过两个方法的作用域被包含在类A的作用域中。

现在只需要一条规则就能解决命名冲突的问题——本地覆盖外部，没有本地就用外部。Fun1中又定义了一个变量x，由于它定义于Fun1的作用域内，所以它覆盖外部的x。在Fun1中访问x就是访问在Fun1中定义的x。而在Fun2中访问x时由于Fun2中没有定义任何x，所以以外部的类A的字段x为x。

## 函数调用

仅仅把几个变量来回交换数值实在是太无聊了。我们还需要变化。我们可以调用预定义的函数或者之前我们已经定义好的函数。

比如我们可以把几个值传入函数，然后把函数返回值赋值给变量。这是比较数学的用法。在函数执行的过程中，没有任何函数外部的变量被改变。

而面向过程编程中，函数还有另一种作用——改变函数外部的状态（或者说变量）。这个特性有时候非常有用。比如，向控制台输出一行文字的函数`Console.WriteLine`，我们调用它并不是需要它的返回值。而是要用它改变命令行状态的副作用。

尽管副作用很有用，但是使用副作用很容易降低代码的可维护性。所以为了自己的头发着想，一定要严格控制副作用的范围。随意使用影响特别大的副作用（例如修改全局变量），会让代码非常难以维护。

## 返回

函数都有输入和返回值。输入由参数确定。而返回值就由返回语句确定。返回语句由关键字`return`引导，后接要返回的值。

一个函数体中可以有多个返回语句。但是只会执行一个。第一个执行的语句把返回值返回后，整个函数的执行过程就终止了。

