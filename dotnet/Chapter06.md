# 流程控制

必要前驱：

- [基本动作](Chapter05.md)

流程控制面向过程中的一个老生常谈的问题。主要是语法层面的问题。这里我就快速略过了。

> 理论上条件跳转语句可以构造出选择和循环。但是高级语言中既然已经有了选择和循环，就最好不要用跳转语句。如果硬要用，很容易降低代码的可维护性。所以C#中虽然提供了goto语句，但是我就不介绍了。

## 选择结构

选择结构最基本的就是if-else。语句。其中if分支是必选项目。else是可选分支。if后加一个返回逻辑值的表达式。如果返回True则执行if分支，否则执行else分支（如果没有else分支，那就什么也不做然后执行if语句后边的东西）。

理论上多分支结构可以通过if-else的并列或者嵌套实现。但是写起来实在很麻烦。C#就提供了一种更为便捷的多分支结构写法，这就是switch语句。

switch语句后接表达式的返回值必须是整数或者字符串。然后在后边的若干个case引导的分支中，每个case对应一个整数或者字符串。表达式返回什么就执行哪个分支。另外还有一个可选的default分支。当没有一个case匹配上的时候就执行这个分支。

> 出于对C语言习俗的继承。switch中各个分支的结尾不用括号表示。而是用关键字`break`表示。
>
> 不过C语言中`break`不是必须的。（如果不写可能导致一些别的情况，这个我们就不深究了。）但是C#中的`break`是必须写的。

## 循环结构

循环结构就是反复执行一段代码。比较经典的就是while循环和do循环。while循环把条件写在循环体前边，如果满足条件就执行循环体。如果不满足条件就跳出循环。而do循环把条件写在循环体后边，执行do循环时，不管三七二十一，先执行一遍循环体。然后看循环条件，如果满足条件继续执行，如果不满足条件就跳出循环。

> 实际上do循环用得很少。如果只有while和do两种循环可用，人们主要用while循环。

后来针对循环变量按循环数递增问题，人们又弄出来一个for循环。for循环本质上还是while循环。只不过在for循环中我们可以格式化地初始循环变量，设置关于循环变量的循环条件，以及递增循环变量。

然后人们又发现，for循环使用频率很高，而且主要是用来遍历线性结构。所以C#中专门又为遍历线性结构设置了一种循环，称为foreach循环。在这种循环中循环条件是不需要写出来的——默认就是遍历完给定的线性结构。不过虽然不用说明循环条件，但是我们总得说明遍历的时候，每次从线性结构中取出来的对象怎么表示。

```C#
int[] myArray = {1,2,3,4};
foreach (int x in myArray)
{
	Console.WriteLine(x);
}
```

上边是一个遍历数组，输出数组中每个对象的例子。其中foreach后的括号中是骨定写法。`in`是关键字，in后边的`myArray`是要遍历的线性结构。`x`表示被遍历对象的一个成员。第一遍循环中它是`myArray`的第一个元素（0号），第二遍循环中它是第二个元素（1号），后边按顺序执行。而`int`是用于说明`x`的类型的。因为这个写法也相当于声明了变量`x`。

> 顺便说一句循环语句和选择结构各个分支内部也相当于一个变量作用域。

另外注意，遍历线性结构的时候，表示线性结构的对象的变量本身（这里是`x`），只能读，不能写。如果你硬要读写也不是没有办法（只要你的列表不是由整数，浮点数这种不可变对象组成就行，通过引用访问可以达到效果）。这里有一个例子：

```c#
using System;
namespace tx02
{
    class Program
    {
        static void Main(string[] args)
        {
            myType[] myArray = {new myType(1),new myType(2),new myType(3),new myType(4)};
            //遍历修改值
            foreach (var x in myArray)
            {
                x.data = x.data * x.data;
            }
            //输出值
            foreach (var x in myArray)
            {
                Console.WriteLine(x.data);
            }
        }
    }

    class myType
    {
        public myType(int i)
        {
            this.data = i;
        }
        public int data = 0;
    }

}
```

> 顺便说一句，C#是支持指针的。但是这个特性属于不安全特性，需要开启不安全特性的使用选项才能使用这个特性。具体就不在这里讨论了。

虽然遍历循环能实质修改被遍历的内容。但是我并不建议这么干。因为遍历本身就是一种偏向函数式的操作。正确的使用姿势是——遍历原列表，同时生成一个新列表，把处理结果放到新列表中。

基本上C#中就是以上四种循环结构。但是由于循环比较麻烦，我们还需要一些辅助的控制语句。首先是`break`，它的作用是直接打断循环。比如我们要通过穷举的方法找到一个解，只要找到一个解，后续的程序就不需要执行了。这时候就可以用条件语句嵌套`break`在找到解后打断循环。

还有`continue`。它的作用是跳过循环体中剩下的步骤，直接进入下一轮循环。比如我们要寻找素数。理论上要用一个数和所有已知素数试除。但是只要发现一个素数是它的因子，就不需要继续用其他素数接着算了，直接`continue`到下一个自然数，判断下一个自然数就行了。

## 其他语句

其实C#也支持C/C++里的`goto`语句，而且在C#中它变得更为安全。但是鉴于这种语句会严重影响代码的可维护性，建议正式代码中一次也不要使用这种语句。

