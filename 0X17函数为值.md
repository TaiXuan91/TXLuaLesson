# 0X17函数为值
## 前置知识
* 0X15类型转换
## 正文
1. 函数定义的语句可以看作一种比较复杂而且比较长的字面值。这个字面值所表示的不是数字，也不是字符串，而是一个函数。
2. 在Lua中函数也被当作值来处理。而且和其他类型的值一样可以用变量存储、可以传递给函数作为参数、可以作为函数的返回值。
3. 但是函数变量有一种别的类型没有特殊的运算——调用。就是我们之前所说的往函数名后边加圆括号和参数列表。就表示调用执行函数。
4. 如果函数名后边没有圆括号和参数列表，它就只是一个存储有函数类型值的变量。它可以给其他变量赋值，也可以被赋予新值。例如：
    >```
    >theFunc=print
    >print=456
    >theFunc(print)
    >```
    第一句把print的值赋予theFunc，此后theFunc(str)的效果就和之前print(str)一样。第二句赋新值给print变量。第三句输出print目前保存的整数值456。
5.  再来看看接受函数参数的函数：
    >```
    >function cal(x,fun) 
    >    print(fun(x))
    >end
    >```
    fun应该是一个函数，x是一个数。计算fun(x)的值，然后输出这个值。可以这样使用：
    >```
    >function sq(x) return x*x end
    >function linear(x) return 3*x+7 end
    >cal(4,sq)
    >cal(4,linear)
    >```
6. 然后是把函数作为返回值的函数。 
    >```
    >function hello() print('hello world') end
    >function myFunc() return hello end
    >f=myFunc()
    >f()
    >```
    第一句定义了一个名为hello的函数，它输出“hello world”。第二句定义的函数把hello函数作为返回值。第三句运行myFunc。第四局运行myFunc的返回值。  
    其实最后两句可以合并一下。myFunc()()的写法也是可以的。
7. 把函数作为返回值更多见的情况是在一个函数定义内嵌套了函数定义。这里给出一个例子:
    >```
    >function addSomething(x)
    >    function addFun(y)
    >        return x+y
    >    end
    >    return addFun
    >end
    >
    >f1=addSomething(4)
    >f1(8)
    >```
    * 例子中的addSomething函数定义中嵌套了一个addFun函数的定义。对于一些返回函数作为返回值的函数来说，要返回的函数定义在自身的定义内部还是外部是没什么影响的。但是这个例子中是有影响的。因为内层函数（要作为返回值的函数）定义中用到了外层函数中的变量x。这涉及到一种名叫“闭包”的机制。
    * “闭包”将会在后续涉及到。这里简单提一句，虽然闭包是很多支持函数式编程语言的特性。但是这个机制却用到了副作用。也就是说函数在运行过程中改变了外部变量的值（这里的x是外层函数的变量，但是却可以被内层变量访问甚至修改。）所以个人认为，闭包可以作为一种多范式语言中，和函数式编程相关的编程工具。但是由于基于副作用，并不推荐在纯函数式编程中使用。
    * 注意，函数定义语句对于函数名来说就像赋值语句。即使之前这个变量名没有被使用过，经过函数定义后它也被赋予了一个函数作为值——它的值不再是定义之前的nil。
8. 想要进一步理清上一条中写的函数定义嵌套。需要介绍一些关于变量的作用域的问题。真个问题将在下一部分讨论。
## 后续推荐
* 0X1C变量作用域