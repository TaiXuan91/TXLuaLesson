# 正名

组合字符就能得到词汇。就我的经验来说，一门语言中，名词的数量总是占有统治性地位。所以我们从Haskell的名词性词汇开始。

名词只是几个字符的组合，它本身没有任何意义——只要能和其他词区别开就可以了。因此在使用名词之前我们需要给名词赋予意义。比如我看到了一个不可名状的东西，你也看到了这个不可名状的东西。我们都知道这个东西长什么样子，但是却没有任何已有的词汇能描述它。于是我们约定用“奈亚子”这个词汇来称呼它。在我们约定之前，“奈亚子”这个词可以没有任何含义。但在我们约定之后，这个词就特指我们都看过的那个不可名状的东西。

自然语言中的名词的含义，都是大多数使用者共识确定的。比如，说起“西游记”，我们都知道这个词指的是什么。不需要临时重新定义。但是在Haskell中，这种有预先定义的词汇比起在自然语言中要少很多。因而在自然语言中，定义新词汇是比较少用到的，但是在Haskell中我们经常需要定义新名词。

我们可以把Haskell中的名词性词汇分为两类：一类是在词法中就已经确定好具体含义的词汇，以后就不再修改的。这一类我们称之为“字面值”。另一类是词法中仅仅规定了这是一个名词性词汇，但是没有在词法中指定具体的含义。这一类我们称之为“标记”。

> “标记”这个词不是Haskell语言报告中的用词，而是我自己用来统称标识符和算符的词。

而标记又可以分为两类——标识符和算符。

> 算符可以当作标识符的一类小特例。它们只能指函数，并且，可以用一些专属的简化写法。

## 标识符（Identifiers）

### 变量标识符（Variable Identifiers）

变量标识符就是以小写字符开头，由小写字符、大写字符或者`'`组成的词。例如`car`，`aCar`，`_system`，`my_car`，`f`，`f'`，`f''`，`siri'sCar`。

> Haskell中下划线`_`一般当作小写字符处理。

之所以叫变量标识符，就是因为这类标识符只能用于指变量。至于什么是变量，这是后续的内容。

### 构造器标识符 （Constructor Identifiers）

构造器标识符和变量标识符相比，只有一个区别——构造器标识符只能以大写字符开头，而不能用小写字符开头。

例如`Tree`，`ThreeTrees`，`Three_Trees`，`F'`，`Tom'sTree`。

构造器标识符只能用于命名构造器。至于什么是构造器，这也是后续的内容。

### 保留标识符 （Reserved Identifiers）

保留标识符只有几个。它们符合变量标识符或构造器标识符的组成规则。但是我们不能把它们当作标识符使用。因为这些词在Haskell中另有用处。

> 保留标识符其实不能起到标识符的作用。只是名字里带有“标识符”这三个字而已。

这是Haskell中全部保留标识符的清单。

表：Haskell中的保留标识符（表头仅表示列数，无其他意义）

| 第1列      | 第2列     | 第3列      | 第4列     |
| ---------- | --------- | ---------- | --------- |
| `case`     | `class`   | `data`     | `default` |
| `deriving` | `do`      | `else`     | `foreign` |
| `if`       | `import`  | `in`       | `infix`   |
| `infixl`   | `infixr`  | `instance` | `let`     |
| `module`   | `newtype` | `of`       | `then`    |
| `type`     | `where`   | `_`        |           |

## 算符 （Operator Symbols）

算符其实可以理解为带有一些特殊语法糖的标识符。虽然Haskell语法中不把算符当作标识符的一种。但是这里我对照着标识符来介绍算符。

### 变量算符 （Variable Operator Symbols）

这类算符和变量标识符对应。由若干个算符类字符组成，并且开头不是`:`。例如`+`，`**`，`>>>`，`+-*/`。

> 算符类字符包括这20个字符`!#$%&*+./<=>?@\^|-~:`。

变量算符的用法其实和变量标识符一样。不过存在以下区别。

| 用途                                                         | 变量标识符                                                   | 变量算符                                               |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------ |
| 表示变量的值本身。                                           | 直接写标识符，不需要特殊语法。例如`f`。但是加上括号也表示同样的意思，例如`(f)`。 | 必须加括号。例如`(+)`。                                |
| 变量的值是一个函数时，以前缀表达式的方式将这个函数作用于参数。 | 直接写标识符，后边跟参数列表。不需要特殊语法。例如`f x y`。  | 算符本身要加括号然后加参数列表。例如`(+) x y`。        |
| 变量的值是一个二元函数时，以中缀表达式方式将这个函数作用于两个参数。 | 用一对反引号把标识符括起来。前后写两个参数。例如<code>x \`f\` y</code>。 | 直接把算符本身写到两个参数之间。例如<code>x+y</code>。 |

> 由于算符默认当作二元函数的中缀应用表达式的一部分。因此单独写一个算符的时候，容易因为左右没有参数，被识别为语法错误。所以，如果要表示算符本身的值，请一定给算符加上括号（必须是圆括号）。

> **关于减号** 由于历史原因，`-`这个符号实际上在数学中表示两种运算。一种是一元函数，取反运算。另一种是二元函数，做差运算。类C语言中一般通过`-`有没有操作数来判断这个符号是表示哪种运算。
>
> Haskell中也通过把`-`当作`negate`的语法糖的形式，实现了和类C语言中相似的功能[^1]。但是这样造成了一个很不美观的特例。按照Haskell的语法，任何一个变量标识符表达的函数都可以用前缀形式应用。而变量算符不加括号的时候都当作二元函数的中缀形式应用。加入`-`替代`negate`的语法糖之后。`-`事实上成了唯一一个一元前缀算符。而且这个变量算符表示的一元前缀应用的时候，自身还不需要加括号。加了括号的`(-)`则是表示做差运算。`((-) 3)`表示的是`\x -> 3-x`，而`(- 3)`表示`-3`。而对于其他变量算符，例如`**`，`((**) 3)`表示`\x->3**x`，而`(** 3)`表示的是`\x -> x**3`（算符本身不加括号，则按照优先级和结合性先进行结合，然后柯里化）。另外，用户还不能定义自己的变量算符版一元运算。所以表示取反的`-`一直是唯一一个变量算符表示的一元运算。总之是非常麻烦，非常特殊。
>
> 为了减轻这种实现带来的思维上的混乱。可以考虑按照如下规则使用：
>
> - 就当没有一元算符`-`。仅仅把`-`当作二元做差运算。
> - 所有变量算符在表示自身的值或者当作前缀使用时都要加括号。例如`(+) 3 5` ，`(-) 10 20`。
> - 如果要取反，使用算符标识符`negate`。
> - `-3`这种写法中，把`-`当作字面值的一部分，而非取反运算。
>
> 如果觉得以上规则复杂，可以考虑把做差`-`映射到其他算符。例如：
>
> ```haskell
> infixl 6 ~~
> x~~y = x-y
> 
> a = 4~~5
> f = (~~ 3) -- \x -> x~~3
> g = ((~~) 3) -- \x -> 3~~x
> b = f a -- value of b is -4
> c = g a -- value of c is 4
> ```

### 构造器算符 （Constructor Operator Symbols）

这类算符由`:`开头，并且由若干算符类字符组成。这类算符相当于构造器标识符。不过构造器标识符能作为值构造器，类型构造器，类型类和模块名称。但是构造器算符只能表示值构造器。

在使用值构造器算符的时候，语法类似变量算符。如果指构造器本身，需要用括号括起来。如果用于构造值，则默认当作二元中缀值构造器。

举个例子：

```haskell
data MyData1 = Int :>> Int deriving(Eq, Show)
x = 3:>>4
y = (:>>) 3 4

-- as comparison
data MyData2 = Var Int Int deriving(Eq, Show)
a = Var 3 4
b = 3 `Var` 4
```

### 保留算符 （Reserved Operator Symbols）

保留算符是符合算符组成规则，但是Haskell中预留做特殊用途的符号组合。它们不一定还可以当作普通算符使用。

表：Haskell中的保留算符（表头仅表示列数，无其他意义）

| 第1列 | 第2列 | 第3列 | 第4列 |
| ----- | ----- | ----- | ----- |
| `..`  | `:`   | `::`  | `=`   |
| `\`   | `|`   | `<-`  | `->`  |
| `@`   | `~`   | `=>`  |       |

[^1]:<https://wiki.haskell.org/Unary_operator>